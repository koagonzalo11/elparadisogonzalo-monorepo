name: Deploy Elparadisogonzalo DApp

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Install dependencies
      run: npm install

    - name: Build frontend
      run: npm run build

    - name: Upload to IPFS
      run: node scripts/uploadToIPFS.js

    - name: Update Unstoppable Domain
      run: node scripts/updateUD.js
name: Build & Deploy to IPFS

on:
  push:
    branches: [ main ]  # or frontend if you prefer

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üßæ Checkout repo
        uses: actions/checkout@v3

      - name: üß∞ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: üì¶ Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: üì• Install dependencies
        run: pnpm install

      - name: üèóÔ∏è Build frontend
        run: pnpm --filter webapp build

      - name: üîê Set up IPFS CLI
        run: |
          curl -O https://dist.ipfs.io/go-ipfs/v0.24.0/go-ipfs_v0.24.0_linux-amd64.tar.gz
          tar -xvzf go-ipfs_v0.24.0_linux-amd64.tar.gz
          cd go-ipfs && sudo bash install.sh

      - name: üöÄ Deploy to IPFS
        run: |
          ipfs init || true
          ipfs daemon &
          sleep 10
          CID=$(ipfs add -Qr packages/webapp/dist)
          echo "üöÄ App deployed at: https://ipfs.io/ipfs/$CID"
          echo "CID=$CID" >> $GITHUB_ENV

      # OPTIONAL: Cloudflare DNSLink update (if API key is added)
      # - name: üåê Update DNSLink via Cloudflare
      #   run: |
      #     curl -X PATCH "https://api.cloudflare.com/client/v4/zones/$CF_ZONE_ID/dns_records/$CF_RECORD_ID" \
      #     -H "Authorization: Bearer $CF_API_TOKEN" \
      #     -H "Content-Type: application/json" \
      #     --data "{\"content\":\"dnslink=/ipfs/$CID\",\"type\":\"TXT\",\"name\":\"_dnslink.$DOMAIN\",\"ttl\":120}"

