# .azure-pipelines.yml
trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  node_version: '18.x'

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '$(node_version)'
    displayName: 'Install Node.js'

  - script: |
      npm install -g hardhat
      npm install
    displayName: 'Install dependencies'

  - script: |
      npx hardhat compile
    displayName: 'Compile Smart Contracts'

  - script: |
      npm test || echo "Tests not set up yet"
    displayName: 'Run Tests'

  # Optional: Lint your codebase
  - script: |
      npm run lint || echo "Linting skipped or not configured"
    displayName: 'Run Linter'

  # Optional: Build frontend
  - script: |
      cd frontend
      npm install
      npm run build
    displayName: 'Build Frontend'

  # Optional: Deploy to Azure Static Web Apps (or similar)
  - task: AzureStaticWebApp@0
    inputs:
      app_location: 'frontend/dist'
      azure_static_web_apps_api_token: $(AZURE_STATIC_WEB_APPS_API_TOKEN)
    displayName: 'Deploy to Azure Static Web Apps'
